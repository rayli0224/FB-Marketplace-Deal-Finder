---
description: Logging style and conventions ‚Äî concise logs, separator lines, no module prefix, transparent data
alwaysApply: true
---

# Logging Preferences

## Principles

- **Clear and concise**: No unneeded information. One idea per line where possible.
- **No level or module prefix**: Log output is the message only (no "INFO:", "DEBUG:", or module name). The formatter in `colored_logger` emits just the message; WARNING and ERROR messages use distinct colors (yellow, bold red) so they still stand out.

## Steps and Horizontal Lines

- **"Step 1", "Step 2", ‚Ä¶** are only for the **overall query** (e.g. "Step 1: Starting search", "Step 2: Scraping Facebook Marketplace", "Step 5: Search completed"). Do not use step numbers for per-listing analysis.
- **Only the explicit main steps get horizontal separator lines.** Use **`log_step_sep(logger, title)`** only for Step 1, Step 2, Step 3, Step 4, Step 5 (and the initial "Search request" if desired). Do **not** use separator lines for: "Search done", "Found N listings", "FB Marketplace search", "Processing N listings", per-listing headers, or per-listing phases (Generating eBay query, Fetching eBay prices, etc.). Use plain **`logger.info(...)`** for those so the log is not cluttered with dividers.
- **Indent section content**: When a block of lines belongs under a heading (e.g. FB Marketplace search fields, per-listing data), call **`set_step_indent("  ")`** before and **`clear_step_indent()`** in a `finally` when the block ends.
- Do not use boxes, borders, or inline wrappers around titles.

## Waiting / Loading Status

- For API requests and other long-running work, use **`wait_status(logger, label)`** as a context manager. It logs "‚è≥ Waiting for {label}...", then every few seconds "  ‚Ä¶ {label} (Ns)", then "‚úÖ Done: {label} (N.Ns)" when the block exits. Use a short, user-friendly label (e.g. "eBay prices", "Facebook Marketplace search", "eBay query (OpenAI)").

## Transparent Data

- Log what is **retrieved** from external sources (e.g. FB Marketplace) and what is **processed** so it‚Äôs visible at default log level.
- For **listing/retrieved blocks** (each item with multiple fields), use **`log_data_block(logger, label, **kwargs)`**: one line for the label with optional **[idx/total]** prefix (e.g. "[1/10] Retrieved:" or "[2/n] FB listing:"), then one indented line per field. Use the numeric total when known; use **n** only when the total is unknown. See **Listing Lines** below.
- Keep verbose or debug-only detail in `logger.debug()`.

## Reusable Helpers

- Use the abstractions in `src.utils.colored_logger` so behavior stays consistent and reusable:
  - `log_step_sep` ‚Äî horizontal separator lines for main steps only (Step 1‚Äì5). Do not use for other headings.
  - `log_step_title` ‚Äî use only when a main-step message needs separator lines (e.g. warning "Step 2: No listings found").
  - `set_step_indent`, `clear_step_indent` ‚Äî indent section content (thread-local; clear in `finally`).
  - `wait_status` ‚Äî context manager for long-running work; logs waiting message and elapsed time every few seconds.
  - `log_data_line` ‚Äî one-line key=value data.
  - `log_data_block` ‚Äî label then one line per field (indented); for listing/retrieved blocks.
  - `log_listing_box_sep` ‚Äî single dash line above and below each list element (Retrieved block, FB listing block).
  - `log_error_short` ‚Äî errors with consistent truncation (no raw `logger.error` with manual truncation).
- When adding new logging, prefer these helpers over ad-hoc `logger.info`/`logger.error` patterns.

## Human-Readable Messages

- **Log and error messages must be understandable by a non-technical person.** They may appear in the debug UI or in support conversations.
- **No technical jargon** in messages. Avoid: selector, DOM, element, h1, div, aria-label, timeout (as a technical term), CSS, XPath, regex, testid, attribute, node, container, wrapper, etc. Use plain language instead (e.g. "the location button", "the zip code box", "listing cards on the page", "the page is still loading", "we could not find where to set your location").
- **Say what went wrong in everyday words** and, when helpful, what the user can infer (e.g. "Results may be for the wrong area", "Facebook may have changed their layout").

## Emojis in Logs

- Use emojis **sparingly** to make log types easy to distinguish at a glance. Do not overkill.
- **Steps / phases**: üîç Step 1 (search start), üìú Step 2 (scrape), üí∞ Step 3 (eBay), üìä Step 4 (scores / processing), ‚úÖ Step 5 (completed).
- **Success / done**: ‚úÖ for completion, "Done:", "Found N deals", "Search done".
- **Warning**: ‚ö†Ô∏è for warnings (auth, no listings, below threshold, cancellation).
- **Error**: ‚ùå applied in `log_error_short` so errors stand out.
- **Waiting**: ‚è≥ "Waiting for {label}..."; ‚úÖ "Done: {label}" (from `wait_status`).
- **Data / counts**: üìã for "Found N listings" or similar summary counts.
- Emojis appear in the raw log message so they propagate to any debug log UI unchanged.

## Listing Lines

- Prefix listing lines with **\[idx/total]** (e.g. "[1/10] Retrieved:", "[2/4] FB listing: ..."). Use the **numeric total when known** (e.g. [1/10], [2/4]); use **n** when the total is unknown (e.g. [1/n], [2/n]).
- Use **`log_data_block`** for each retrieved/listing entry: label line with [idx/total] prefix, then indented lines per field. Continuation lines (Description, Data block fields) have no prefix and are indented so they are clearly part of that entry.
- When an optional feature is turned off and affects what gets logged (e.g. "descriptions toggled off"), log that once with an information emoji (e.g. ‚ÑπÔ∏è) and plain language so the user knows why some detail is missing.
- **Keep per-listing logs minimal at INFO**: one line per phase and one summary line for results; put verbose detail in **DEBUG**.
- **Box each list element**: use **`log_listing_box_sep(logger)`** (single dash line) above and below each Retrieved block and each FB listing block so each element is visually contained.

## What to Avoid

- Do not log verbose or repetitive detail at INFO (e.g. raw API responses, multi-line params); use DEBUG.
- Do not add a module/source prefix (e.g. `[api]`, `[fb_scraper]`) to log output.
- Do not use empty `logger.info("")` for spacing; use separator lines instead.
- Do not truncate step titles inline with ".." when using separators; the title is on its own line.
